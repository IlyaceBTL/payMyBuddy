<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Profil</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>
<body>
<nav class="header-navigation" role="navigation" aria-label="Menu principal">
    <div class="logo" aria-label="Accueil Pay My Buddy" tabindex="0">Pay My Buddy</div>
    <div class="items">
        <a th:href="@{/dashboard}" class="nav-link" aria-label="Transférer">Transférer</a>
        <a th:href="@{/profile}" class="nav-link active" aria-current="page" aria-label="Profil">Profil</a>
        <a th:href="@{/relation}" class="nav-link" aria-label="Ajouter relation">Ajouter relation</a>
        <form id="logoutForm" th:action="@{/logout}" method="post" style="display:inline;">
            <a href="#" class="nav-link" aria-label="Se déconnecter" onclick="document.getElementById('logoutForm').submit(); return false;">Se déconnecter</a>
        </form>
    </div>
</nav>
<main class="profile-container" role="main" aria-labelledby="profile-title">
    <h2 id="profile-title" tabindex="0">Mon Profil</h2>
    <div class="profile-flex">
        <div class="profile-info">
            <div class="profile-row">
                <span class="profile-label" id="label-lastName">Nom :</span>
                <span class="profile-value" th:text="${user.lastName}" aria-labelledby="label-lastName">Nom</span>
            </div>
            <div class="profile-row">
                <span class="profile-label" id="label-firstName">Prénom :</span>
                <span class="profile-value" th:text="${user.firstName}" aria-labelledby="label-firstName">Prénom</span>
            </div>
            <div class="profile-row">
                <span class="profile-label" id="label-userName">Nom d'utilisateur :</span>
                <span class="profile-value" th:text="${user.userName}" aria-labelledby="label-userName">@username</span>
            </div>
            <div class="profile-row">
                <span class="profile-label" id="label-email">Email :</span>
                <span class="profile-value" th:text="${user.email}" aria-labelledby="label-email">nom@domain.com</span>
            </div>
            <div class="profile-row">
                <span class="profile-label" id="label-password">Mot de passe :</span>
                <span class="profile-value" aria-labelledby="label-password">********</span>
                <button class="edit-btn" aria-label="Modifier le profil" onclick="showEditForm(event)">Modifier</button>
            </div>
        </div>
        <form class="edit-form" th:action="@{/profile/edit}" th:object="${profileDto}" method="post" aria-label="Formulaire de modification du profil" style="display:none;">
            <div th:if="${#fields.hasErrors()}" class="form-error" th:errors="*{global}" aria-live="assertive" role="alert"></div>
            <div class="profile-row">
                <label class="profile-label" for="lastName">Nom :</label>
                <input type="text" id="lastName" th:field="*{lastName}" th:value="${user.lastName}" required aria-required="true" aria-label="Nom">
                <span class="form-error" th:errors="*{lastName}" aria-live="polite"></span>
            </div>
            <div class="profile-row">
                <label class="profile-label" for="firstName">Prénom :</label>
                <input type="text" id="firstName" th:field="*{firstName}" th:value="${user.firstName}" required aria-required="true" aria-label="Prénom">
                <span class="form-error" th:errors="*{firstName}" aria-live="polite"></span>
            </div>
            <div class="profile-row">
                <label class="profile-label" for="userName">Nom d'utilisateur :</label>
                <input type="text" id="userName" th:field="*{userName}" th:value="${user.userName}" required aria-required="true" aria-label="Nom d'utilisateur">
                <span class="form-error" th:errors="*{userName}" aria-live="polite"></span>
            </div>
            <div class="profile-row">
                <label class="profile-label" for="email">Email :</label>
                <input type="email" id="email" th:field="*{email}" th:value="${user.email}" required aria-required="true" aria-label="Email">
                <span class="form-error" th:errors="*{email}" aria-live="polite"></span>
            </div>
            <div class="profile-row">
                <label class="profile-label" for="password">Mot de passe (pour valider) :</label>
                <input type="password" id="password" th:field="*{password}" autocomplete="current-password" required aria-required="true" aria-label="Mot de passe">
                <span class="form-error" th:errors="*{password}" aria-live="polite"></span>
            </div>
            <div class="profile-row profile-row-btns">
                <button type="submit" class="edit-btn" aria-label="Enregistrer les modifications">Enregistrer</button>
                <button type="button" class="edit-btn" aria-label="Annuler la modification" onclick="hideEditForm(event)">Annuler</button>
            </div>
        </form>
    </div>
</main>
<script>
    function showEditForm(e) {
        e.preventDefault();
        document.querySelector('.edit-form').style.display = 'block';
        document.querySelector('.profile-info .edit-btn').style.display = 'none';
    }
    function hideEditForm(e) {
        e.preventDefault();
        document.querySelector('.edit-form').style.display = 'none';
        document.querySelector('.profile-info .edit-btn').style.display = 'inline-block';
    }
</script>
</body>
</html>